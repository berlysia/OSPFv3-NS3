
## Link State Retransmission List
各ルータは、アジャセンシーに対して一つずつこのリストを持つ。
これはフラッディングしたが確認応答がきていないLSAのリストである。
確認応答がくるか、アジャセンシーが死ぬとこのリストから消える。

## Link State Request List
各ルータは、ネイバーに対して一つずつこのリストを生成する。
ネイバーとのLSDBの同期を行うために使う、期限切れなどにより改めて受け取るべきLSAのリストである。
このリストはDatabaseDescriptionパケットの受信によって生成され、
ExchangeDoneの後にこのリストが空でないなら、LinkStateRequestパケットが送信される。
このリストは適切なLinkStateUpdateパケットの受信によって消化されていく。

## Database Summary List
LSDBを構成する完全なLSAのリストとして、ネイバーがDatabase Exchange状態（つまりExStartのタイミング）になったときに作成される。
このリストがDatabaseDescriptionパケットによって送信される。確認応答が得られると、送信した分は削除される。



OSPF packetのやりとりに関する図
https://tools.ietf.org/html/rfc2328#page-106

Database Description packetのM/SはルータIDが大きい方がMaster

```
+---+                                         +---+
|RT1|                                         |RT2|
+---+                                         +---+

Down                                          Down
              Hello(DR=0,seen=0)
         ------------------------------>
           Hello (DR=RT2,seen=RT1,...)      Init
         <------------------------------
ExStart      D-D (Seq=x,I,M,Master)
         ------------------------------>
             D-D (Seq=y,I,M,Master)         ExStart
         <------------------------------
Exchange       D-D (Seq=y,M,Slave)
         ------------------------------>
             D-D (Seq=y+1,M,Master)         Exchange
         <------------------------------
             D-D (Seq=y+1,M,Slave)
         ------------------------------>
                      ...
                      ...
                      ...
              D-D (Seq=y+n, Master)
         <------------------------------
              D-D (Seq=y+n, Slave)
Loading  ------------------------------>
                   LS Request                   Full
         ------------------------------>
                   LS Update
         <------------------------------
                   LS Request
         ------------------------------>
                   LS Update
         <------------------------------
Full

```


rfc2328 Section. 13 The Flooding Procedure

Link State Updateパケットは、LSAをフラッディングするメカニズムを提供します。リンク状態更新パケットは、いくつかの別個のLSAを含むことができ、それぞれのLSAをその発信点からさらに遠くに溢れさせる。フラッディング手順を信頼できるものにするには、各LSAを個別に確認する必要があります。肯定応答は、リンク状態肯定応答パケットで送信される。多くの個別の確認応答をまとめて1つのパケットにまとめることもできます。
フラッディング手順は、リンクステートアップデートパケットが受信されたときに開始されます。受信されたパケットは、フラッディング手順に渡される前に、多くの整合性チェックが行われています（8.2項を参照）。特に、リンク状態更新パケットは、特定の近隣および特定の領域に関連付けられている。ネイバーがExchangeより小さい状態にある場合、パケットはそれ以上の処理を行わずにドロップする必要があります。
AS外部LSA以外のすべてのタイプのLSAは、特定の領域に関連付けられています。ただし、LSAには領域フィールドは含まれていません。 LSAのエリアはリンクステートアップデートパケットヘッダーから導かれなければなりません。
LSUパケットに含まれるLSAのそれぞれに対して次の手順が取られます：
1. LSAのLSチェックサムを確認します。不正であれば破棄して次のLSAを見ます。
2. LSAのLSタイプを確認します。unknownであれば破棄して次のLSAを見ます。
3. あるいは、LSタイプが5(AS-external-LSA)であれば……（今回は無視）
4. あるいは、LSAのageがMaxAgeと等しく、かつルータのLSDBにそのLSAが存在せず、さらに近隣ルータにExchangeかLoading状態なものが存在しない場合、次の手順をとります。
    1. LSAckを近隣ルータに送信します。
    2. LSAを破棄して次のLSAを見ます。
5. LSDBにLSAのインスタンスがあるか探します。存在しないか、今受け取ったLSAの方がより新しい場合（新しさの確認方法はSection13.1で）は、次の手順をとります。
    1. すでにコピーが存在して、フラッディングにより受け取ったものであって、それが追加されてからMinLSArrival経っていない場合、破棄して次のLSAを見ます。
    2. そうでなければこのLSAをすぐにインターフェースからフラッディングします。
    3. 全てのリンク状態再送信リストから現在のDBのコピーを削除します。
    4. 新しいLSAをLSDBにインストールします。ルーティングテーブルの再計算がスケジューリングされるかもしれません。新たなLSAの追加時刻はこの段階での時刻を使います。フラッディング機構はここでインストールされたLSAをMinLSArrival秒が経過するまで上書きできません。LSAのインストールについてはSection 13.2を参照してください。
    5. 場合によってはLSAを受け取った証としてLSAckを、受信したインターフェースから送り返すかもしれません。Section13.5を参照してください。
        1. 1で既存のものより新しいLSAを受け取っており、2でフラッディングが行われた場合は、LSAckを受信したインターフェースから送り返す。
        2. 2でフラッディングが行われた場合はLSAckは送らない。
    6. もしこの新たなLSAが自分自身が発行したものであった場合、なんかよくわかんないから実装しない
6. 送信中近隣リンク状態リクエストリストの中にLSAを見つけた場合、データベース交換のプロセスにエラーが生じているということです。この場合は、近隣イベントのBadLSReqを送信してLSUの処理を中断させることにより、データベース交換プロセスを再始動します。
7. 全く同じインスタンスをLSDBの中に見つけた場合、次の2つの手順で処理されます。
    1. LSAがリンク状態再送信リストの中にある場合、このルータ自身がこのLSAに対する確認応答を待っているところです。ルータは受け取ったLSAを確認応答として扱い、リンク状態再送信リストから削除します。これは「暗黙の確認応答」と呼ばれるものです。確認応答プロセスSection13.5を参照してください。
    2. 場合によってはLSAを受け取った証としてLSAckを、受信したインターフェースから送り返すかもしれません。Section13.5を参照してください。
        1. 暗黙の確認応答として扱った場合、BDRはなんかいろいろやって送り返し、そうでなければ送らない。
        2. 暗黙の確認応答として扱わない場合、直接確認応答を送り返す。
8. LSDB内のデータの方が新しい場合、DB内のもののLS ageがMaxAgeと等しくかつLSシーケンス番号がMaxSequenceNumberに等しい場合は、単に応答なく破棄します。そうでない場合は、直近のMinLSArrival秒からまだ送信されていないぶんを、LSUとして当該近隣ルータに送信します。このときLSUは近隣ルータに直接送信する必要があり、これをリンク状態再送信リストには入れず、確認応答は送信しないでください。
